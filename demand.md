项目需求文档：网球自动发球机视觉计分系统1. 项目背景与目标场景描述：在网球自动发球场景中（参考现场照片），用户向挂有分值标靶（10/20/30分）的柔性幕布击球。核心需求：开发一套视觉计分软件，能够接入实时视频流，自动识别网球击中幕布的事件，判断击中点所在的得分区域，并实时累加分数。技术策略：采用“幕布微动检测（触发器）”+“图像回溯定位（分类器）”的两阶段方案，无需复杂的深度学习训练。2. 系统核心逻辑 (System Logic)此部分为开发核心，建议重点标注前置机制：环形缓冲 (Ring Buffer)系统需在内存中维护一个持续更新的视频缓冲区，始终保留当前时刻前 N 秒（建议 1.0~1.5秒）的高清视频帧。这是实现“回溯”的基础。阶段一：全局监控与触发 (The Trigger)利用帧差法或光流法实时监测幕布区域。当检测到幕布出现剧烈的、辐射状的像素抖动时，判定为“击中”，锁定触发时间戳 $T$。阶段二：回溯与定位 (The Locator)系统立即调取缓冲区中 $T$ 时刻前后的一组关键帧（如 $T-200ms$ 到 $T+100ms$）。在这些帧中，锁定震动中心区域，利用**颜色提取（寻找黄绿色）**确定球体接触幕布的确切坐标 $(x, y)$。阶段三：计分判定判断坐标 $(x, y)$ 是否在用户预先画好的“得分圈”内。3. 功能需求详情 (Functional Requirements)3.1 初始化与标定模块 (Calibration)FR-01 视频源支持：支持 USB/RTSP 实时视频流。关键需求：支持上传本地 .mp4 文件进行离线测试（用于算法调优）。FR-02 交互式区域标定 (ROI)：界面需提供绘图工具（圆形/多边形）。得分区：用户在画面上绘制多个“得分圈”，并为每个圈输入分值（10/20/30）。干扰屏蔽区（重要）：用户需能框选“有效检测区”（只包含幕布），强制排除画面下方的绿色地板、散落的网球以及人员活动区域。配置保存：标定结果需能保存为配置文件，下次启动自动加载。3.2 实时运行模式 (Run Mode)FR-03 实时计分：击中点在圈内 -> 总分增加对应分值。击中点在圈外（但在幕布上） -> 不计分（可显示 "Miss"）。FR-04 防抖动/冷却 (Debounce)：设置冷却时间（例如 1.5秒）。在一次有效得分后的 1.5秒内，忽略所有的幕布抖动，防止因为幕布晃动不止而导致系统重复加分。FR-05 视觉反馈：在屏幕画面上的击中位置画一个红圈或爆炸特效。屏幕中央弹出 "+30" 的浮动大字。4. 非功能性需求 (Non-Functional)实时性：从击球到显示分数的延迟应小于 500ms。硬件兼容性：算法应足够轻量，能在普通 PC 上流畅运行（不需要昂贵的显卡）。鲁棒性：需适应室内顶灯光照，且不受地面散落网球（静态物体）的干扰。5. 给开发者的特别备注 (Technical Tips)基于你提供的照片 IMG_9197.HEIC，请将以下建议转达给开发人员：关于干扰排除（Masking is Key）：照片中有一个小朋友在挥拍，且地面是绿色的。开发建议：务必在算法中加入 Mask（掩膜），只计算上半部分幕布的像素变化。必须切掉下半部分，否则小朋友跑动或挥拍会误触发“震动检测”，地上的绿色球也会干扰“颜色查找”。关于找球 vs 找波纹：由于发球机球速快，摄像头拍到的球可能有拖影（Motion Blur）。开发建议：在阶段二回溯时，不要强求识别完美的圆形。只要在震动中心附近找到“黄绿色的色块质心”即可认为是球的落点。关于透视变形：照片并非正对幕布拍摄，存在透视角度。开发建议：标定工具最好支持绘制椭圆或自由多边形，而不仅仅是正圆，这样能更贴合幕布上的视觉形状。